2024-08-06T02:24:13.746545522Z time="2024-08-06T02:24:13Z" level=debug msg="Sync Service: initialized" func=sync.InitService file="service.go:67" component=sync-server listen="0.0.0.0:8001"
2024-08-06T02:24:13.747042901Z time="2024-08-06T02:24:13Z" level=info msg="Started sync server at 0.0.0.0:8001" func=sync.NewServer file="server.go:30"
2024-08-06T02:24:14.751333438Z time="2024-08-06T02:24:14Z" level=info msg="The sync server of backing Image Manager listening to 0.0.0.0:8001" func=manager.NewServer file="server.go:34"
2024-08-06T02:24:14.751993685Z time="2024-08-06T02:24:14Z" level=info msg="Backing Image Manager listening to 0.0.0.0:8000" func=manager.NewServer file="server.go:55"
2024-08-06T02:24:16.550117691Z time="2024-08-06T02:24:16Z" level=info msg="Backing Image Manager: prepare to start backing image update watch" func="manager.(*Manager).Watch" file="service.go:567" component=backing-image-manager diskPath=/data/ diskUUID=7b70705b-57bb-4ccb-b9bb-5e6ec0c76249
2024-08-06T02:24:16.550147838Z time="2024-08-06T02:24:16Z" level=info msg="Backing Image Manager: backing image update watch started" func="manager.(*Manager).Watch" file="service.go:582" component=backing-image-manager diskPath=/data/ diskUUID=7b70705b-57bb-4ccb-b9bb-5e6ec0c76249
2024-08-06T02:24:16.551045574Z time="2024-08-06T02:24:16Z" level=info msg="Backing Image Manager: prepare to sync backing image" func="manager.(*Manager).Sync" file="service.go:310" biName=default-image-qwfqg biUUID=59c0d774 component=backing-image-manager diskPath=/data/ diskUUID=7b70705b-57bb-4ccb-b9bb-5e6ec0c76249 fromAddress="10.52.0.108:8000"
2024-08-06T02:24:16.551599761Z time="2024-08-06T02:24:16Z" level=debug msg="Sync Service: initializing sync file /data/backing-images/default-image-qwfqg-59c0d774/backing" func="sync.(*Service).checkAndInitSyncFile" file="service.go:269" component=sync-server listen="0.0.0.0:8001"
2024-08-06T02:24:16.551687887Z time="2024-08-06T02:24:16Z" level=info msg="Backing Image Manager: started receiving backing image at port 30001" func="manager.(*Manager).Sync" file="service.go:382" biName=default-image-qwfqg biUUID=59c0d774 component=backing-image-manager diskPath=/data/ diskUUID=7b70705b-57bb-4ccb-b9bb-5e6ec0c76249 fromAddress="10.52.0.108:8000"
2024-08-06T02:24:16.551816079Z time="2024-08-06T02:24:16Z" level=info msg="SyncingFile: cannot to reuse the existing file, will clean it up then start processing: stat /data/backing-images/default-image-qwfqg-59c0d774/backing: no such file or directory" func=sync.NewSyncingFile.func1 file="sync_file.go:178" component=sync-file filePath=/data/backing-images/default-image-qwfqg-59c0d774/backing uuid=59c0d774
2024-08-06T02:24:17.551928416Z time="2024-08-06T02:24:17Z" level=info msg="SyncingFile: start to launch a receiver at port 30001" func="sync.(*SyncingFile).Receive" file="sync_file.go:625" component=sync-file filePath=/data/backing-images/default-image-qwfqg-59c0d774/backing uuid=59c0d774
2024-08-06T02:24:17.551966047Z time="2024-08-06T02:24:17Z" level=info msg="Creating Ssync service" func=rest.Server file="server.go:79"
2024-08-06T02:24:17.551978290Z time="2024-08-06T02:24:17Z" level=info msg="file /data/backing-images/default-image-qwfqg-59c0d774/backing.tmp does not exist" func=rest.Server file="server.go:92"
2024-08-06T02:24:17.552561272Z time="2024-08-06T02:24:17Z" level=debug msg="failed to get IP from lhnet1 interface, fallback to use the default pod IP 10.52.1.29" func=util.GetIPForPod file="http_util.go:65" error="route ip+net: no such network interface"
2024-08-06T02:24:17.555939513Z time="2024-08-06T02:24:17Z" level=info msg="Backing Image Manager: started requesting sending backing image from address 10.52.0.108:8000 to address 10.52.1.29:30001" func="manager.(*Manager).Sync.func3" file="service.go:379" biName=default-image-qwfqg biUUID=59c0d774 component=backing-image-manager diskPath=/data/ diskUUID=7b70705b-57bb-4ccb-b9bb-5e6ec0c76249 fromAddress="10.52.0.108:8000"
2024-08-06T02:24:17.557091589Z time="2024-08-06T02:24:17Z" level=info msg="Receiving /data/backing-images/default-image-qwfqg-59c0d774/backing.tmp: size 261357568, directIO false" func="rest.(*SyncServer).doOpen" file="handlers.go:103"
2024-08-06T02:24:17.557120945Z time="2024-08-06T02:24:17Z" level=info msg="Ssync server is opened and ready for receiving file /data/backing-images/default-image-qwfqg-59c0d774/backing.tmp" func="rest.(*SyncServer).open" file="handlers.go:84"
2024-08-06T02:24:19.406018753Z time="2024-08-06T02:24:19Z" level=info msg="Closing Ssync server" func="rest.(*SyncServer).close" file="handlers.go:165"
2024-08-06T02:24:19.406393340Z time="2024-08-06T02:24:19Z" level=debug msg="SyncingFile: failed to get the checksum from a valid config during processing wrap-up, will directly calculated it then" func="sync.(*SyncingFile).finishProcessing" file="sync_file.go:761"
2024-08-06T02:24:19.930483666Z time="2024-08-06T02:24:19Z" level=debug msg="SyncingFile: writing config file when the file becomes ready" func="sync.(*SyncingFile).writeConfigNoLock" file="sync_file.go:856" component=sync-file currentChecksum=1a9518d76cd3fa3adf7ee4126f6ab7e89b209d7056be7d7a6b57e7760f4b9a5a6bae54cb11a0cb125571011135bb3f47052189d74a523aa5e81ab1af6de0acfb filePath=/data/backing-images/default-image-qwfqg-59c0d774/backing size=261357568 uuid=59c0d774
2024-08-06T02:24:19.930643618Z time="2024-08-06T02:24:19Z" level=info msg="SyncingFile: succeeded processing file" func="sync.(*SyncingFile).postProcessSyncFile" file="sync_file.go:807" component=sync-file currentChecksum=1a9518d76cd3fa3adf7ee4126f6ab7e89b209d7056be7d7a6b57e7760f4b9a5a6bae54cb11a0cb125571011135bb3f47052189d74a523aa5e81ab1af6de0acfb filePath=/data/backing-images/default-image-qwfqg-59c0d774/backing size=261357568 uuid=59c0d774
2024-08-06T02:24:20.557529150Z time="2024-08-06T02:24:20Z" level=info msg="Backing Image Manager: start to release port 30001 after syncing" func="manager.(*Manager).Sync.func2" file="service.go:324" biName=default-image-qwfqg biUUID=59c0d774 component=backing-image-manager diskPath=/data/ diskUUID=7b70705b-57bb-4ccb-b9bb-5e6ec0c76249 fromAddress="10.52.0.108:8000"
2024-08-06T02:24:21.559146195Z time="2024-08-06T02:24:21Z" level=info msg="Backing Image Manager: released port 30001 after syncing" func="manager.(*Manager).Sync.func2" file="service.go:332" biName=default-image-qwfqg biUUID=59c0d774 component=backing-image-manager diskPath=/data/ diskUUID=7b70705b-57bb-4ccb-b9bb-5e6ec0c76249 fromAddress="10.52.0.108:8000"
2024-08-06T12:54:39.427565711Z time="2024-08-06T12:54:39Z" level=info msg="Backing Image Manager: prepare to fetch backing image" func="manager.(*Manager).Fetch" file="service.go:447" biName=default-image-nntjr biUUID=a0ffc77a component=backing-image-manager data_source_address="10.52.1.32:8000" diskPath=/data/ diskUUID=7b70705b-57bb-4ccb-b9bb-5e6ec0c76249
2024-08-06T12:54:39.427615065Z time="2024-08-06T12:54:39Z" level=info msg="Backing Image Manager: need to transfer the file from the data source server first" func="manager.(*Manager).Fetch" file="service.go:461" biName=default-image-nntjr biUUID=a0ffc77a component=backing-image-manager data_source_address="10.52.1.32:8000" diskPath=/data/ diskUUID=7b70705b-57bb-4ccb-b9bb-5e6ec0c76249
2024-08-06T12:54:39.430046240Z time="2024-08-06T12:54:39Z" level=debug msg="Sync Service: initializing sync file /data/backing-images/default-image-nntjr-a0ffc77a/backing" func="sync.(*Service).checkAndInitSyncFile" file="service.go:269" component=sync-server listen="0.0.0.0:8001"
2024-08-06T12:54:39.430158804Z time="2024-08-06T12:54:39Z" level=info msg="SyncingFile: cannot to reuse the existing file, will clean it up then start processing: stat /data/backing-images/default-image-nntjr-a0ffc77a/backing: no such file or directory" func=sync.NewSyncingFile.func1 file="sync_file.go:178" component=sync-file filePath=/data/backing-images/default-image-nntjr-a0ffc77a/backing uuid=a0ffc77a
2024-08-06T12:54:39.430224268Z time="2024-08-06T12:54:39Z" level=info msg="Backing Image Manager: fetched or reused backing image" func="manager.(*Manager).Fetch" file="service.go:485" biName=default-image-nntjr biUUID=a0ffc77a component=backing-image-manager data_source_address="10.52.1.32:8000" diskPath=/data/ diskUUID=7b70705b-57bb-4ccb-b9bb-5e6ec0c76249
2024-08-06T12:54:40.431296863Z time="2024-08-06T12:54:40Z" level=info msg="SyncingFile: start to fetch sync file from /data/tmp/default-image-nntjr-a0ffc77a" func="sync.(*SyncingFile).Fetch" file="sync_file.go:422" component=sync-file filePath=/data/backing-images/default-image-nntjr-a0ffc77a/backing uuid=a0ffc77a
2024-08-06T12:54:40.431336308Z time="2024-08-06T12:54:40Z" level=debug msg="SyncingFile: need to fetch the syncing file from /data/tmp/default-image-nntjr-a0ffc77a" func="sync.(*SyncingFile).Fetch" file="sync_file.go:457" component=sync-file filePath=/data/backing-images/default-image-nntjr-a0ffc77a/backing uuid=a0ffc77a
2024-08-06T12:54:40.431345756Z time="2024-08-06T12:54:40Z" level=debug msg="SyncingFile: found the corresponding src config file /data/tmp/default-image-nntjr-a0ffc77a.cfg" func="sync.(*SyncingFile).Fetch" file="sync_file.go:471" component=sync-file filePath=/data/backing-images/default-image-nntjr-a0ffc77a/backing uuid=a0ffc77a
2024-08-06T12:54:40.431411390Z time="2024-08-06T12:54:40Z" level=debug msg="SyncingFile: directly get the checksum from the valid config during processing wrap-up: 1b35a52bd32f5257b3454787c87688fdbe3fdd018a47ed2cf9a7cca71630f54230ceefd544cd984adf7593974b0087a9da2e51eaf9fea8a105ce86ef4be5fc76" func="sync.(*SyncingFile).finishProcessing" file="sync_file.go:746"
2024-08-06T12:54:40.488997135Z time="2024-08-06T12:54:40Z" level=debug msg="SyncingFile: writing config file when the file becomes ready" func="sync.(*SyncingFile).writeConfigNoLock" file="sync_file.go:856" component=sync-file currentChecksum=1b35a52bd32f5257b3454787c87688fdbe3fdd018a47ed2cf9a7cca71630f54230ceefd544cd984adf7593974b0087a9da2e51eaf9fea8a105ce86ef4be5fc76 filePath=/data/backing-images/default-image-nntjr-a0ffc77a/backing size=1487339520 uuid=a0ffc77a
2024-08-06T12:54:40.489296533Z time="2024-08-06T12:54:40Z" level=info msg="SyncingFile: succeeded processing file" func="sync.(*SyncingFile).finishProcessing" file="sync_file.go:757" component=sync-file currentChecksum=1b35a52bd32f5257b3454787c87688fdbe3fdd018a47ed2cf9a7cca71630f54230ceefd544cd984adf7593974b0087a9da2e51eaf9fea8a105ce86ef4be5fc76 filePath=/data/backing-images/default-image-nntjr-a0ffc77a/backing size=1487339520 uuid=a0ffc77a
2024-08-06T12:54:40.489325648Z time="2024-08-06T12:54:40Z" level=info msg="SyncingFile: try to clean up src file /data/tmp/default-image-nntjr-a0ffc77a and its config file /data/tmp/default-image-nntjr-a0ffc77a.cfg after fetch" func="sync.(*SyncingFile).Fetch.func1" file="sync_file.go:430" component=sync-file currentChecksum=1b35a52bd32f5257b3454787c87688fdbe3fdd018a47ed2cf9a7cca71630f54230ceefd544cd984adf7593974b0087a9da2e51eaf9fea8a105ce86ef4be5fc76 filePath=/data/backing-images/default-image-nntjr-a0ffc77a/backing size=1487339520 uuid=a0ffc77a
